<UserControl x:Class="CCity.View.GameWindow"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:custom="clr-namespace:CCity.View.CustomElements"
             xmlns:converter="clr-namespace:CCity.ViewModel.Converters"
             mc:Ignorable="d" 
             d:DesignHeight="550"
             d:DesignWidth="900"
             Background="White"
             FontFamily="Arial"
             SizeChanged="UserControl_SizeChanged"
             KeyUp="UserControl_KeyUp">
    <UserControl.Resources>
        <converter:TextureEnumToPath x:Key="TextureEnumToPath" />
        <converter:TextureEnumToIsOversized x:Key="TextureEnumToIsOversized" />
        <converter:ColorToSolidColorBrush x:Key="ColorToSolidColorBrush" />
        <converter:ToolEnumToPath x:Key="ToolEnumToPath" />
    </UserControl.Resources>
    <!-- 
        Layer 1
            Logbook
        Layer 2
            Toolbar
                Tools
                Togglers
                Tax buttons
            Left bottom corner
                Minimap
                Control bar
                    Minimap toggler
                    City data
                    Speed
            Right bottom status bar
                Logbook toggler
                Game data
            Right top
                Exit button
                Tool info
                Field info
                    Zone info
                    Basic info
                    Buttons
        Layer 3
            Fields
    -->
    <Grid>

        <!-- ============================== LAYER 1 ============================== -->
        <Grid Panel.ZIndex="20" Background="#A000">
            <!-- ============================== Logbook ============================== -->
            <Border Width="300" Margin="50" Background="#FFF" CornerRadius="3">
                <DockPanel >
                    <Grid Margin="5 5" DockPanel.Dock="Top">
                        <Label FontSize="14" FontWeight="Bold" Content="Költségvetés" VerticalAlignment="Center"/>
                        <custom:CustomButton CustomBackground="{StaticResource PrimaryColor}" Width="24" Height="24" FontSize="14" HorizontalAlignment="Right" Margin="5" CornerRadius="12" Command="{Binding ToggleLogbookCommand}" CustomContent="×"/>
                    </Grid>
                    <ScrollViewer Margin="0 0 0 3" VerticalScrollBarVisibility="Visible">
                        <ItemsControl ItemsSource="{Binding Logbook}">
                            <ItemsControl.ItemsPanel>
                                <ItemsPanelTemplate>
                                    <StackPanel Orientation="Vertical" />
                                </ItemsPanelTemplate>
                            </ItemsControl.ItemsPanel>
                            <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                    <Grid Margin="10 5">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="Auto"/>
                                        </Grid.ColumnDefinitions>

                                        <TextBlock Grid.Column="0" Text="{Binding TransactionName}"/>
                                        <TextBlock Grid.Column="1" Text="{Binding Amount}">
                                            <TextBlock.Style>
                                                <Style TargetType="TextBlock">
                                                    <Style.Triggers>
                                                        <DataTrigger Binding="{Binding Add}" Value="True">
                                                            <Setter Property="Foreground" Value="Green"/>
                                                        </DataTrigger>
                                                        <DataTrigger Binding="{Binding Add}" Value="False">
                                                            <Setter Property="Foreground" Value="Red"/>
                                                        </DataTrigger>
                                                    </Style.Triggers>
                                                </Style>
                                            </TextBlock.Style>
                                        </TextBlock>
                                    </Grid>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                    </ScrollViewer>
                </DockPanel>
            </Border>
            <!-- ______________________________ Logbook ______________________________ -->
            <Grid.Style>
                <Style TargetType="Grid">
                    <Style.Triggers>
                        <DataTrigger Binding="{Binding IsLogbookToggled}" Value="True">
                            <Setter Property="Visibility" Value="Visible"/>
                        </DataTrigger>
                        <DataTrigger Binding="{Binding IsLogbookToggled}" Value="False">
                            <Setter Property="Visibility" Value="Collapsed"/>
                        </DataTrigger>
                    </Style.Triggers>
                </Style>
            </Grid.Style>
        </Grid>
        <!-- ______________________________ LAYER 1 ______________________________ -->

        <!-- ============================== LAYER 2 ============================== -->
        <Grid Panel.ZIndex="10">
            <!-- ============================== Toolbar ============================== -->
            <Border Background="#CCC" Width="78" Height="Auto" Margin="7" CornerRadius="5" Padding="0 4" VerticalAlignment="Top" HorizontalAlignment="Left">
                <StackPanel Orientation="Vertical">
                    <!-- ============================== Tools ============================== -->
                    <ItemsControl ItemsSource="{Binding Tools}">
                        <ItemsControl.ItemsPanel>
                            <ItemsPanelTemplate>
                                <WrapPanel Margin="0 5" HorizontalAlignment="Center"></WrapPanel>
                            </ItemsPanelTemplate>
                        </ItemsControl.ItemsPanel>
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <custom:CustomSwitchButton Cursor="Hand" Width="36" Height="36" Margin="0" Command="{Binding ClickCommand}" CommandParameter="{Binding Number}" IsToggled="{Binding IsSelected}">
                                    <custom:CustomSwitchButton.CustomContent>
                                        <Grid>
                                            <Grid Panel.ZIndex="1">
                                                <Image Stretch="Fill" Source="{Binding Tool, Converter={StaticResource ToolEnumToPath}}" RenderOptions.BitmapScalingMode="HighQuality">
                                                    <Image.Clip>
                                                        <RectangleGeometry RadiusX="3" RadiusY="3" Rect="0,0,32,32" />
                                                    </Image.Clip>
                                                </Image>
                                            </Grid>
                                        </Grid>
                                    </custom:CustomSwitchButton.CustomContent>
                                </custom:CustomSwitchButton>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                    <!-- ______________________________ Tools ______________________________ -->

                    <StackPanel Margin="0 5 0 0" Orientation="Vertical" VerticalAlignment="Bottom" HorizontalAlignment="Center">
                        <!-- ============================== Togglers ============================== -->
                        <StackPanel Orientation="Horizontal">
                            <custom:CustomSwitchButton CustomContent="Közút" Height="35" Width="35" Margin="1 5" FontSize="8" Command="{Binding TogglePublicityCommand}" IsToggled="{Binding IsPublicityToggled}"/>
                            <custom:CustomSwitchButton CustomContent="Áram" Height="35" Width="35" Margin="1 5" FontSize="8" Command="{Binding ToggleElectricityCommand}" IsToggled="{Binding IsElectricityToggled}"/>
                        </StackPanel>
                        <!-- ______________________________ Togglers ______________________________ -->

                        <!-- ============================== Tax buttons ============================== -->
                        <StackPanel Orientation="Vertical" Margin="0 5">
                            <custom:TaxControl TaxValue="{Binding ResidentialTax}" TaxCommand="{Binding ChangeResidentialTaxCommand}"/>
                            <custom:TaxControl TaxValue="{Binding CommercialTax}" TaxCommand="{Binding ChangeCommercialTaxCommand}"/>
                            <custom:TaxControl TaxValue="{Binding IndustrialTax}" TaxCommand="{Binding ChangeIndustrialTaxCommand}"/>
                        </StackPanel>
                        <!-- ______________________________ Tax buttons ______________________________ -->
                    </StackPanel>
                </StackPanel>
            </Border>
            <!-- ______________________________ Toolbar ______________________________ -->

            <!-- ============================== Left bottom corner ============================== -->
            <StackPanel Orientation="Vertical" VerticalAlignment="Bottom" HorizontalAlignment="Left" >
                <!-- ============================== Minimap ============================== -->
                <Border x:Name="Minimap" Width="Auto" Height="Auto" BorderThickness="2" BorderBrush="#CCC" VerticalAlignment="Bottom" HorizontalAlignment="Left" Margin="21 0">
                    <Grid>
                        <Canvas HorizontalAlignment="Stretch" VerticalAlignment="Stretch" Panel.ZIndex="20" ClipToBounds="True">
                            <Rectangle x:Name="MinimapBorder" Stroke="#D02" StrokeThickness="1" Fill="Transparent"/>
                        </Canvas>
                        <ItemsControl ItemsSource="{Binding Fields}">
                            <ItemsControl.ItemsPanel>
                                <ItemsPanelTemplate>
                                    <UniformGrid Rows="{Binding Height}" Columns="{Binding Width}" Width="Auto" Height="Auto"/>
                                </ItemsPanelTemplate>
                            </ItemsControl.ItemsPanel>
                            <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                    <Grid RenderOptions.EdgeMode="Aliased" Width="5" Height="5">
                                        <Grid Background="{Binding OverlayColor, Converter={StaticResource ColorToSolidColorBrush}}" Panel.ZIndex="2"></Grid>
                                        <Grid Panel.ZIndex="1">
                                            <Image Stretch="Fill" Source="{Binding Texture, Converter={StaticResource TextureEnumToPath}}" RenderOptions.BitmapScalingMode="HighQuality"/>
                                        </Grid>
                                        <Grid Panel.ZIndex="0">
                                            <Image Stretch="Fill" Source="Images/Textures/grass.png"/>
                                        </Grid>
                                    </Grid>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                    </Grid>
                    <Border.Style>
                        <Style TargetType="Border">
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding MinimapMinimized}" Value="True">
                                    <Setter Property="Visibility" Value="Hidden" />
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </Border.Style>
                </Border>
                <!-- ______________________________ Minimap ______________________________ -->

                <!-- ============================== Control bar ============================== -->
                <Border Background="#CCC" Margin="7" CornerRadius="14" Height="28">
                    <StackPanel Orientation="Horizontal">
                        <!-- ============================== Minimap toggler ============================== -->
                        <custom:CustomButton Width="28" Height="28" CustomBackground="{StaticResource PrimaryColor}" CornerRadius="14" Cursor="Hand" FontSize="20" Command="{Binding ChangeMinimapSizeCommand}">
                            <custom:CustomButton.Style>
                                <Style TargetType="custom:CustomButton">
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding MinimapMinimized}" Value="True">
                                            <Setter Property="CustomContent" Value="+" />
                                        </DataTrigger>
                                        <DataTrigger Binding="{Binding MinimapMinimized}" Value="False">
                                            <Setter Property="CustomContent" Value="-" />
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </custom:CustomButton.Style>
                        </custom:CustomButton>
                        <!-- ______________________________ Minimap toggler ______________________________ -->

                        <!-- ============================== City data ============================== -->
                        <TextBlock Text="{Binding CityName}" Margin="15 7 0 7"/>
                        <TextBlock Text="{Binding MayorName}" Margin="15 7"/>
                        <!-- ______________________________ City data ______________________________ -->

                        <!-- ============================== Speed ============================== -->
                        <StackPanel Orientation="Horizontal">
                            <custom:CustomButton Width="28" Height="28" CustomBackground="{StaticResource PrimaryColor}" CornerRadius="14 0 0 14" Command="{Binding ChangeSpeedCommand}" CommandParameter="-1" CustomContent="-"/>
                            <custom:CustomButton Width="28" Height="28" CustomBackground="{StaticResource PrimaryColor}" FontWeight="Bold" Command="{Binding PauseGameCommand}">
                                <custom:CustomButton.Style>
                                    <Style TargetType="custom:CustomButton">
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding Paused}" Value="True">
                                                <Setter Property="CustomContent" Value="▶️"/>
                                            </DataTrigger>
                                            <DataTrigger Binding="{Binding Paused}" Value="False">
                                                <Setter Property="CustomContent" Value="⏸️"/>
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </custom:CustomButton.Style>
                            </custom:CustomButton>
                            <custom:CustomButton Width="28" Height="28" CustomBackground="{StaticResource PrimaryColor}" CornerRadius="0 14 14 0" Command="{Binding ChangeSpeedCommand}" CommandParameter="1" CustomContent="+"/>
                            <TextBlock VerticalAlignment="Center" Text="{Binding Speed, StringFormat='🕜: {0}'}" Margin="15 7"/>
                            <!-- ______________________________ Speed ______________________________ -->
                        </StackPanel>
                    </StackPanel>
                </Border>
                <!-- ______________________________ Control bar ______________________________ -->
            </StackPanel>
            <!-- ______________________________ Left bottom corner ______________________________ -->

            <!-- ============================== Right bottom status bar ============================== -->
            <Border Background="#CCC" VerticalAlignment="Bottom" HorizontalAlignment="Right" Margin="7" CornerRadius="14" Height="28">
                <StackPanel Orientation="Horizontal">
                    <!-- ============================== Logbook toggler ============================== -->
                    <custom:CustomButton Width="28" Height="28" CustomBackground="{StaticResource PrimaryColor}" CornerRadius="14" Cursor="Hand" FontSize="12" Command="{Binding ToggleLogbookCommand}" CustomContent="🗒️"/>
                    <!-- ______________________________ Logbook toggler ______________________________ -->

                    <!-- ============================== Game data ============================== -->
                    <TextBlock Text="{Binding Population, StringFormat='🤵 {0:N0}'}" Margin="7"/>
                    <TextBlock Text="{Binding Satisfaction, StringFormat='👍 {0}%'}" Margin="7"/>
                    <TextBlock Text="{Binding Budget, StringFormat='💎 {0:N0}'}" Margin="7"/>
                    <TextBlock Text="{Binding Date, StringFormat='📅 yyyy.MM.dd'}" Margin="7"/>
                    <!-- ______________________________ Game data ______________________________ -->
                </StackPanel>
            </Border>
            <!-- ______________________________ Right bottom status bar ______________________________ -->

            <!-- ============================== Right top ============================== -->
            <StackPanel Orientation="Vertical" VerticalAlignment="Top" HorizontalAlignment="Right">
                <!-- ============================== Exit button ============================== -->
                <custom:CustomButton Command="{Binding ExitGameCommand}" CustomBackground="{StaticResource DangerColor}" CornerRadius="12" HorizontalAlignment="Right" Width="24" Height="24" Cursor="Hand" Margin="12" FontSize="14" CustomContent="×"/>
                <!-- ______________________________ Exit button ______________________________ -->

                <!-- ============================== Tool info ============================== -->
                <Border Background="#CCC" CornerRadius="5" Margin="7">
                    <StackPanel Orientation="Vertical" Margin="5 10">
                        <TextBlock FontWeight="Bold" FontSize="14" Margin="0 10" Text="{Binding SelectedToolPlaceableName}"/>
                        <StackPanel Orientation="Horizontal" Margin="0 1">
                            <Label Margin="0" Padding="0" Content="Méret: "/>
                            <Label Margin="0" Padding="0" Content="{Binding SelectedToolPlaceableWidth}"/>
                            <Label Margin="0" Padding="0" Content="×"/>
                            <Label Margin="0" Padding="0" Content="{Binding SelectedToolPlaceableHeight}"/>
                        </StackPanel>
                        <TextBlock Margin="0 1" Text="{Binding SelectedToolPlaceablePlacementCost, StringFormat='Lehelyezés: {0} 💎'}"/>
                        <TextBlock Margin="0 1" Text="{Binding SelectedToolPlaceableMaintenanceCost, StringFormat='Fenntartás: {0} 💎 / év'}"/>
                    </StackPanel>
                    <Border.Style>
                        <Style TargetType="Border">
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding SelectedToolHasInfo}" Value="False">
                                    <Setter Property="Visibility" Value="Collapsed"/>
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </Border.Style>
                </Border>
                <!-- ______________________________ Tool info ______________________________ -->

                <!-- ============================== Field info ============================== -->
                <Border Background="#CCC" CornerRadius="5" Width="150" Margin="7">
                    <StackPanel Orientation="Vertical">
                        <custom:CustomButton Width="24" Height="24" Cursor="Hand" CustomBackground="{StaticResource PrimaryColor}" CornerRadius="12" FontSize="14"  HorizontalAlignment="Right" Margin="5" Command="{Binding CloseSelectedFieldWindowCommand}" CustomContent="×"/>
                        <TextBlock Margin="5 0 5 10" FontWeight="Bold" FontSize="14" Text="{Binding SelectedFieldName}"/>

                        <!-- ============================== Zone info ============================== -->
                        <StackPanel Orientation="Vertical" Margin="5 0">
                            <StackPanel Margin="0 2" Orientation="Horizontal">
                                <Label Margin="0" Padding="0" Content="Polgárok: "/>
                                <Label Margin="0" Padding="0" Content="{Binding SelectedFieldPopulation}"/>
                                <Label Margin="0" Padding="0" Content=" / "/>
                                <Label Margin="0" Padding="0" Content="{Binding SelectedFieldCapacity}"/>
                                <Label Margin="0" Padding="0" Content=" fő"/>
                            </StackPanel>
                            <TextBlock Margin="0 2" Text="{Binding SelectedFieldSatisfaction, StringFormat='Elégedettség: {0}%'}"/>
                            <StackPanel.Style>
                                <Style TargetType="StackPanel">
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding SelectedFieldIsZone}" Value="False">
                                            <Setter Property="Visibility" Value="Collapsed"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </StackPanel.Style>
                        </StackPanel>
                        <!-- ______________________________ Zone info ______________________________ -->

                        <!-- ============================== Basic info ============================== -->
                        <StackPanel Orientation="Vertical" Margin="5 0">
                            <TextBlock Margin="0 2" Text="{Binding SelectedFieldPoliceDepartmentEffect, StringFormat='Rendőrség effekt: {0}%'}"/>
                            <TextBlock Margin="0 2" Text="{Binding SelectedFieldFireDepartmentEffect, StringFormat='Tűzoltóság effekt: {0}%'}"/>
                            <TextBlock Margin="0 2" Text="{Binding SelectedFieldStadiumEffect, StringFormat='Stadion effekt: {0}%'}"/>
                            <TextBlock Margin="0 2" Text="{Binding SelectedFieldIndustrialEffect, StringFormat='Ipari zóna effekt: {0}%'}"/>
                            <TextBlock Margin="0 2" Text="{Binding SelectedFieldForestEffect, StringFormat='Erdő effekt: {0}%'}"/>
                            <StackPanel Margin="0 2" Orientation="Horizontal">
                                <Label Margin="0" Padding="0" Content="Áramellátás: "/>
                                <Label Margin="0" Padding="0" Content="{Binding SelectedFieldCurrentElectricity}"/>
                                <Label Margin="0" Padding="0" Content=" / "/>
                                <Label Margin="0" Padding="0" Content="{Binding SelectedFieldNeededElectricity}"/>
                                <StackPanel.Style>
                                    <Style TargetType="StackPanel">
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding SelectedFieldShowsElectricity}" Value="False">
                                                <Setter Property="Visibility" Value="Collapsed"/>
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </StackPanel.Style>
                            </StackPanel>
                            <TextBlock Margin="0 2" Text="{Binding SelectedFieldResidentialZoneDesireToMoveIn, StringFormat='Beköltözési kedv: {0}%'}">
                                <TextBlock.Style>
                                    <Style TargetType="TextBlock">
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding SelectedFieldIsResidentialZone}" Value="False">
                                                <Setter Property="Visibility" Value="Collapsed"/>
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </TextBlock.Style>
                            </TextBlock>
                            <TextBlock Margin="0 2" Text="{Binding SelectedFieldForestAge, StringFormat='Életkor: {0} év'}">
                                <TextBlock.Style>
                                    <Style TargetType="TextBlock">
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding SelectedFieldIsForest}" Value="False">
                                                <Setter Property="Visibility" Value="Collapsed"/>
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </TextBlock.Style>
                            </TextBlock>
                            <TextBlock Margin="0 2" Text="{Binding SelectedFieldHealth, StringFormat='Állapot: {0}%'}">
                                <TextBlock.Style>
                                    <Style TargetType="TextBlock">
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding SelectedFieldIsFlammable}" Value="False">
                                                <Setter Property="Visibility" Value="Collapsed"/>
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </TextBlock.Style>
                            </TextBlock>
                        </StackPanel>
                        <!-- ______________________________ Basic info ______________________________ -->

                        <!-- ============================== Buttons ============================== -->
                        <StackPanel Orientation="Vertical" Margin="0 5">
                            <custom:CustomButton Command="{Binding UpgradeSelectedFieldCommand}" CustomBackground="{StaticResource PrimaryColor}" CornerRadius="3" Margin="5 2" Height="24">
                                <custom:CustomButton.CustomContent>
                                    <StackPanel Orientation="Horizontal">
                                        <Label Margin="0" Padding="0" Content="Fejlesztés ("/>
                                        <Label Margin="0" Padding="0" Content="{Binding SelectedFieldUpgradeCost}"/>
                                        <Label Margin="0" Padding="0" Content="💎)"/>
                                    </StackPanel>
                                </custom:CustomButton.CustomContent>
                                <custom:CustomButton.Style>
                                    <Style TargetType="custom:CustomButton">
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding SelectedFieldIsUpgradeable}" Value="False">
                                                <Setter Property="Visibility" Value="Collapsed"/>
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </custom:CustomButton.Style>
                            </custom:CustomButton>
                            <custom:CustomButton Command="{Binding SendFiretruckToSelectedFieldCommand}" CustomBackground="{StaticResource PrimaryColor}" CornerRadius="3" Margin="5 2" Height="24" CustomContent="Tűzoltófecskendő">
                                <custom:CustomButton.Style>
                                    <Style TargetType="custom:CustomButton">
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding SelectedFieldIsIncinerated}" Value="False">
                                                <Setter Property="Visibility" Value="Collapsed"/>
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </custom:CustomButton.Style>
                            </custom:CustomButton>
                        </StackPanel>
                    </StackPanel>
                    <!-- ______________________________ Buttons ______________________________ -->
                    <Border.Style>
                        <Style TargetType="Border">
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding IsFieldSelected}" Value="False">
                                    <Setter Property="Visibility" Value="Collapsed"/>
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </Border.Style>
                </Border>
                <!-- ______________________________ Field info ______________________________ -->
            </StackPanel>
            <!-- ______________________________ Right top ______________________________ -->
        </Grid>
        <!-- ______________________________ LAYER 2 ______________________________ -->

        <!-- ============================== LAYER 3 ============================== -->
        <Grid x:Name="Center">
            <!-- ============================== Fields ============================== -->
            <Grid Panel.ZIndex="1" x:Name="FieldsContainerGrid">
                <ScrollViewer x:Name="MapScrollViewer" HorizontalScrollBarVisibility="Hidden" VerticalScrollBarVisibility="Hidden" CanContentScroll="False" PanningMode="Both"
                    PreviewMouseLeftButtonDown="MapScrollViewer_PreviewMouseLeftButtonDown"
                    PreviewMouseMove="MapScrollViewer_PreviewMouseMove"
                    PreviewMouseLeftButtonUp="MapScrollViewer_PreviewMouseLeftButtonUp"
                    Loaded="MapScrollViewer_Loaded"
                    ScrollChanged="MapScrollViewer_ScrollChanged"
                    SizeChanged="MapScrollViewer_SizeChanged">
                    <Grid>
                        <ItemsControl ItemsSource="{Binding Fields}">
                            <ItemsControl.ItemsPanel>
                                <ItemsPanelTemplate>
                                    <UniformGrid Rows="{Binding Height}" Columns="{Binding Width}" Width="Auto" Height="Auto" Margin="150"/>
                                </ItemsPanelTemplate>
                            </ItemsControl.ItemsPanel>
                            <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                    <Button Command="{Binding ClickCommand}" Width="50" Height="50" CommandParameter="{Binding Number}" Style="{StaticResource FieldButton}" RenderOptions.EdgeMode="Aliased">
                                        <Grid>
                                            <Canvas Panel.ZIndex="3" Width="50">
                                                <Grid Panel.ZIndex="6" Background="#00000000" Width="50" MouseEnter="Grid_MouseEnter" MouseLeave="Grid_MouseLeave">
                                                    <Grid Width="50" Height="50" VerticalAlignment="Bottom" Background="{Binding OverlayColor, Converter={StaticResource ColorToSolidColorBrush}}" Panel.ZIndex="5"></Grid>
                                                    <Grid.Style>
                                                        <Style TargetType="Grid">
                                                            <Style.Triggers>
                                                                <DataTrigger Binding="{Binding Texture, Converter={StaticResource TextureEnumToIsOversized}}" Value="True">
                                                                    <Setter Property="Height" Value="65"/>
                                                                </DataTrigger>
                                                                <DataTrigger Binding="{Binding Texture, Converter={StaticResource TextureEnumToIsOversized}}" Value="False">
                                                                    <Setter Property="Height" Value="50"/>
                                                                </DataTrigger>
                                                            </Style.Triggers>
                                                        </Style>
                                                    </Grid.Style>
                                                </Grid>
                                                <Grid Width="50" Panel.ZIndex="3">
                                                    <Image Width="50" Stretch="Uniform" VerticalAlignment="Bottom" Source="{Binding AdditionalTexture, Converter={StaticResource TextureEnumToPath}}" RenderOptions.BitmapScalingMode="HighQuality"/>
                                                    <Grid.Style>
                                                        <Style TargetType="Grid">
                                                            <Style.Triggers>
                                                                <DataTrigger Binding="{Binding Texture, Converter={StaticResource TextureEnumToIsOversized}}" Value="True">
                                                                    <Setter Property="Height" Value="65"/>
                                                                    <Setter Property="VerticalAlignment" Value="Bottom"/>
                                                                </DataTrigger>
                                                                <DataTrigger Binding="{Binding Texture, Converter={StaticResource TextureEnumToIsOversized}}" Value="False">
                                                                    <Setter Property="Height" Value="50"/>
                                                                </DataTrigger>
                                                            </Style.Triggers>
                                                        </Style>
                                                    </Grid.Style>
                                                </Grid>
                                                <Grid Width="50" Panel.ZIndex="2">
                                                    <Image Width="50" Stretch="Uniform" Source="{Binding Texture, Converter={StaticResource TextureEnumToPath}}" RenderOptions.BitmapScalingMode="HighQuality"/>
                                                    <Grid.Style>
                                                        <Style TargetType="Grid">
                                                            <Style.Triggers>
                                                                <DataTrigger Binding="{Binding Texture, Converter={StaticResource TextureEnumToIsOversized}}" Value="True">
                                                                    <Setter Property="Height" Value="65"/>
                                                                    <Setter Property="VerticalAlignment" Value="Bottom"/>
                                                                </DataTrigger>
                                                                <DataTrigger Binding="{Binding Texture, Converter={StaticResource TextureEnumToIsOversized}}" Value="False">
                                                                    <Setter Property="Height" Value="50"/>
                                                                </DataTrigger>
                                                            </Style.Triggers>
                                                        </Style>
                                                    </Grid.Style>
                                                </Grid>
                                                <Canvas.Style>
                                                    <Style TargetType="Canvas">
                                                        <Style.Triggers>
                                                            <DataTrigger Binding="{Binding Texture, Converter={StaticResource TextureEnumToIsOversized}}" Value="True">
                                                                <Setter Property="Height" Value="65"/>
                                                                <Setter Property="VerticalAlignment" Value="Bottom"/>
                                                            </DataTrigger>
                                                            <DataTrigger Binding="{Binding Texture, Converter={StaticResource TextureEnumToIsOversized}}" Value="False">
                                                                <Setter Property="Height" Value="50"/>
                                                            </DataTrigger>
                                                        </Style.Triggers>
                                                    </Style>
                                                </Canvas.Style>
                                            </Canvas>
                                            <Grid Panel.ZIndex="0">
                                                <Image Stretch="Fill" Source="Images/Textures/grass.png" RenderOptions.BitmapScalingMode="HighQuality"/>
                                            </Grid>
                                        </Grid>
                                    </Button>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                        <Grid.Background>
                            <VisualBrush TileMode="Tile" Viewport="0,0,400,400" ViewportUnits="Absolute">
                                <VisualBrush.Visual>
                                    <Image Source="Images/Textures/background.png" />
                                </VisualBrush.Visual>
                            </VisualBrush>
                        </Grid.Background>
                    </Grid>
                </ScrollViewer>
            </Grid>
            <!-- ______________________________ Fields ______________________________ -->
        </Grid>
        <!-- ______________________________ LAYER 3 ______________________________ -->
    </Grid>
</UserControl>
